(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[1],{265:function(t,e,s){"use strict";s.r(e);var a=s(286);var i=s(270);for(var l in i)if(l!=="default")(function(t){s.d(e,t,function(){return i[t]})})(l);var o=s(282);var r=s(2);var n=Object(r["a"])(i["default"],a["a"],a["b"],false,null,"f52d7dca",null);e["default"]=n.exports},270:function(t,e,s){"use strict";s.r(e);var a=s(271);var i=s.n(a);for(var l in a)if(l!=="default")(function(t){s.d(e,t,function(){return a[t]})})(l);e["default"]=i.a},271:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:true});e.default=void 0;var a="/del_excel";var i="/analysis_apply_excel";var l="/get_root_position_list";var o="/get_sub_position_list";var r="/get_leader";var n="/submit_apply_list";var c={data:function t(){return{isDropdownShow:false,isLeader:false,isAdmin:false,username:"",showInfoForm:true,showMultiImport:false,excelFiles:[],inputVisible:false,multiInput:{leaders:"无",campus:"",college:"",specificLocation:"",applyReason:""},formData:{applicant:"",leaders:"无",goodName:"",goodCode:"",campus:"",college:"",specificLocation:"",num:1,getDate:"",applyReason:""},precision:0,successApply:[],allSuccessApply:[],selected:{selectedRows:[]},pagination:{current:1,count:50,limit:10},campusList:[],collegeList:[],rules:{goodName:[{required:true,message:"必填项",trigger:"blur"}],getDate:[{required:true,message:"必填项",trigger:"blur"}],goodCode:[{required:true,message:"必填项",trigger:"blur"}],campus:[{required:true,message:"必填项",trigger:"blur"}],college:[{required:true,message:"必填项",trigger:"blur"}],applyReason:[{required:true,message:"必填项",trigger:"blur"}],specificLocation:[{required:true,message:"必填项",trigger:"blur"}]}}},watch:{showMultiImport:function t(e){this.changUploadName();this.showInfoForm=!e},"formData.campus":function t(e){var s=this;var a=this.getParentCode(e);this.$http.get(o,{params:{parent_code:a}}).then(function(t){s.collegeList=t.data})},"multiInput.campus":function t(e){var s=this;var a=this.getParentCode(e);this.$http.get(o,{params:{parent_code:a}}).then(function(t){s.collegeList=t.data})}},created:function t(){this.username=this.$store.state.user.username;this.isLeader=this.$store.state.isLeader;this.isAdmin=this.$store.state.isAdmin;this.formData.applicant=this.username;this.loadData()},mounted:function t(){},methods:{loadData:function t(){this.getRootPositionList();this.getLeaders()},getInfoTableLabel:function t(){return"导员"},getLeaders:function t(){var e=this;this.$http.get(r).then(function(t){if(t){if(t.result===true&&t.code!=="220"){e.formData.leaders=t.data;e.multiInput.leaders=t.data}}})},getParentCode:function t(e){var s="";for(var a=0;a<this.campusList.length;a++){if(this.campusList[a].id===e){s=this.campusList[a].code;break}}return s},getRootPositionList:function t(){var e=this;this.$http.get(l).then(function(t){e.campusList=t.data})},changUploadName:function t(){var e=document.querySelector(".file-wrapper");if(e!==undefined&&e!==null){document.querySelector(".file-wrapper").setAttribute("bk-lablename","选择文件")}},commitMultiApply:function t(){if(this.selected.selectedRows.length===0){this.handleError({theme:"warning"},"未选择任何数据");return}this.inputVisible=true},confirmMultiCommit:function t(){var e=this;if(!this.multiInput.campus||!this.multiInput.specificLocation||!this.multiInput.applyReason||!this.multiInput.college){this.handleError({theme:"warning"},"任何数据不能为空");return}var s=[];for(var a=0;a<this.allSuccessApply.length;a++){var i=this.selected.selectedRows.indexOf(this.allSuccessApply[a].id);if(i!==-1){this.allSuccessApply[a]["good_code"]=this.allSuccessApply[a]["goodCode"];delete this.allSuccessApply[a].goodCode;this.allSuccessApply[a]["good_name"]=this.allSuccessApply[a]["goodName"];delete this.allSuccessApply[a].goodName;this.allSuccessApply[a]["require_date"]=this.allSuccessApply[a]["getDate"];delete this.allSuccessApply[a].getDate;this.allSuccessApply[a]["apply_user"]=this.allSuccessApply[a]["applicant"];delete this.allSuccessApply[a].applicant;this.allSuccessApply[a]["leaders"]=this.multiInput.leaders;this.allSuccessApply[a]["school"]=this.campusList.find(this.multiInputCampusLocationIdToName).name;this.allSuccessApply[a]["academy"]=this.collegeList.find(this.multiInputCollegeLocationIdToName).name;this.allSuccessApply[a]["detail_position"]=this.multiInput.specificLocation;this.allSuccessApply[a]["reason"]=this.multiInput.applyReason;s.push(this.allSuccessApply[a])}}for(var l=0;l<s.length;l++){var o=this.allSuccessApply.indexOf(s[l]);this.allSuccessApply.splice(o,1)}this.$http.post(n,{apply_list:s}).then(function(t){if(t.result===true){e.handleError({theme:"success"},t.message)}else if(t.result===false){e.handleError({theme:"error"},t.message)}});this.selected.selectedRows=[];this.getSuccessApply(this.pagination.current);this.inputVisible=false},formDataCampusLocationIdToName:function t(e){return e.id===this.formData.campus},formDataCollegeLocationIdToName:function t(e){return e.id===this.formData.college},multiInputCampusLocationIdToName:function t(e){return e.id===this.multiInput.campus},multiInputCollegeLocationIdToName:function t(e){return e.id===this.multiInput.college},commitApply:function t(){var e=this;this.$refs.infoForm.validate().then(function(t){var s=[];var a=new Object;a["good_code"]=e.formData.goodCode;a["good_name"]=e.formData.goodName;if(e.formData.getDate){a["require_date"]=e.dateFormat("YYYY-mm-dd",e.formData.getDate)}else{a["require_date"]=""}a["apply_user"]=e.formData.applicant;a["leaders"]=e.formData.leaders;a["school"]=e.campusList.find(e.formDataCampusLocationIdToName).name;a["academy"]=e.collegeList.find(e.formDataCollegeLocationIdToName).name;a["detail_position"]=e.formData.specificLocation;a["reason"]=e.formData.applyReason;a["num"]=e.formData.num;s.push(a);e.$http.post(n,{apply_list:s}).then(function(t){if(t.result===true){e.handleError({theme:"success"},t.message);e.sleep(2).then(function(t){e.refresh()})}else if(t.result===false){e.handleError({theme:"error"},t.message)}})},function(t){})},dateFormat:function t(e,s){var a;var i={"Y+":s.getFullYear().toString(),"m+":(s.getMonth()+1).toString(),"d+":s.getDate().toString(),"H+":s.getHours().toString(),"M+":s.getMinutes().toString(),"S+":s.getSeconds().toString()};for(var l in i){a=new RegExp("("+l+")").exec(e);if(a){e=e.replace(a[1],a[1].length===1?i[l]:i[l].padStart(a[1].length,"0"))}}return e},multiImport:function t(){this.showInfoForm=false;this.showMultiImport=true;this.getSuccessApply(this.pagination.current)},getSuccessApply:function t(e){this.successApply=[];for(var s=(e-1)*this.pagination.limit;this.successApply.length<this.pagination.limit&&s<this.allSuccessApply.length;s++){this.successApply.push(this.allSuccessApply[s])}this.pagination.count=this.allSuccessApply.length},dropdownShow:function t(){this.isDropdownShow=true},dropdownHide:function t(){this.isDropdownShow=false},selectRow:function t(e,s){var a=this.selected.selectedRows.indexOf(s.id);if(a!==-1){this.selected.selectedRows.splice(a,1)}else{this.selected.selectedRows.push(s.id)}},selectAll:function t(){var e=true;for(var s=0;s<this.successApply.length;s++){var a=this.selected.selectedRows.indexOf(this.successApply[s].id);if(a===-1){e=false}if(!e){break}}if(this.selected.selectedRows.length!==0&&!e){for(var i=0;i<this.successApply.length;i++){if(this.selected.selectedRows.indexOf(this.successApply[i].id)===-1){this.selected.selectedRows.push(this.successApply[i].id)}}}else if(this.selected.selectedRows.length!==0&&e){for(var l=0;l<this.successApply.length;l++){var o=this.selected.selectedRows.indexOf(this.successApply[l].id);this.selected.selectedRows.splice(o,1)}}else if(this.selected.selectedRows.length===0){for(var r=0;r<this.successApply.length;r++){this.selected.selectedRows.push(this.successApply[r].id)}}},upload:function t(e){var s=this;this.getBase64(e.fileObj.origin).then(function(t){var l=t.split(",")[1];var o=s.username+"_"+e.fileObj.name;s.$http.post(i,{file:l,fileName:o}).then(function(t){if(t&&t.result===true){s.handleError({theme:"success"},t.message);var e=t.data;console.log(t.data);for(var i=0;i<e.success_list.length;i++){var l=new Object;l.id=i+1;l.applicant=e.success_list[i][0];l.goodCode=e.success_list[i][1];l.goodName=e.success_list[i][2];l.num=e.success_list[i][3];l.getDate=e.success_list[i][6];s.allSuccessApply.push(l)}}else if(t&&t.result===false){s.handleError({theme:"error"},t.message)}if(t&&t.result===true&&t.code===5003){s.handleError({theme:"warning"},"存在申请导入失败");var r=document.createElement("a");r.href=t.data.file_url;document.body.appendChild(r);r.click();document.body.removeChild(r)}s.excelFiles.push({name:o});s.excelFiles=[];s.getSuccessApply(s.pagination.current);s.sleep(2).then(function(){var t="analysis_apply_excel";s.$http.post(a,{dirName:t,fileName:o}).then(function(){})})})})},getBase64:function t(e){return new Promise(function(t,s){var a=new FileReader;var i="";a.readAsDataURL(e);a.onload=function(){i=a.result};a.onerror=function(t){s(t)};a.onloadend=function(){t(i)}})},handleError:function t(e,s){e.message=s;e.offsetY=80;this.$bkMessage(e)},handlePageLimitChange:function t(){this.pagination.limit=arguments[0];this.pagination.current=1;this.getSuccessApply(this.pagination.current)},handlePageChange:function t(e){this.pagination.current=e;this.getSuccessApply(this.pagination.current)},sleep:function t(e){return new Promise(function(t,s){setTimeout(t,e*1e3)})},refresh:function t(){this.$router.go(0)}}};e.default=c},272:function(t,e,s){},282:function(t,e,s){"use strict";var a=s(272);var i=s.n(a);var l=i.a},286:function(t,e,s){"use strict";var a=function(){var t=this;var e=t.$createElement;var s=t._self._c||e;return s("div",{staticClass:"applyHome-wrapper"},[s("div",{staticClass:"header"},[s("bk-divider",{attrs:{align:"left"}},[s("bk-tag",{staticStyle:{"font-size":"13px"},attrs:{type:"filled"}},[s("span",{staticStyle:{cursor:"pointer"},on:{click:t.refresh}},[t._v("首页")])])],1)],1),t._v(" "),s("div",{staticClass:"switcher"},[s("bk-tag",{staticStyle:{"margin-right":"10px"}},[t._v("批量申请")]),t._v(" "),s("bk-switcher",{attrs:{theme:"primary"},model:{value:t.showMultiImport,callback:function(e){t.showMultiImport=e},expression:"showMultiImport"}})],1),t._v(" "),t.showInfoForm?s("div",{staticClass:"info-table"},[s("bk-form",{ref:"infoForm",attrs:{"label-width":130,model:t.formData,rules:t.rules}},[s("bk-container",{attrs:{col:12,margin:6}},[s("bk-row",{staticClass:"info-table-row"},[s("bk-col",{attrs:{span:3}},[s("div",{staticClass:"applicant"},[s("bk-form-item",{attrs:{label:"申请人",property:"applicant"}},[s("bk-tag",[t._v(t._s(t.formData.applicant))])],1)],1)]),t._v(" "),s("bk-col",{attrs:{span:3}},[s("div",{staticClass:"group-leaders"},[s("bk-form-item",{attrs:{label:t.getInfoTableLabel(),property:"leaders"}},[s("bk-tag",[t._v(t._s(t.formData.leaders))])],1)],1)]),t._v(" "),s("bk-col",{attrs:{span:3}},[s("div",{staticClass:"apply-good-name"},[s("bk-form-item",{attrs:{label:"申请物品名",required:true,property:"goodName"}},[s("bk-input",{attrs:{placeholder:""},model:{value:t.formData.goodName,callback:function(e){t.$set(t.formData,"goodName",e)},expression:"formData.goodName"}})],1)],1)]),t._v(" "),s("bk-col",{attrs:{span:3}},[s("div",{staticClass:"apply-good-code"},[s("bk-form-item",{attrs:{label:"申请物品编号",required:true,property:"goodCode"}},[s("bk-input",{attrs:{placeholder:""},model:{value:t.formData.goodCode,callback:function(e){t.$set(t.formData,"goodCode",e)},expression:"formData.goodCode"}})],1)],1)])],1),t._v(" "),s("bk-row",{staticClass:"info-table-row"},[s("bk-col",{attrs:{span:3}},[s("div",{staticClass:"campus"},[s("bk-form-item",{attrs:{label:"校区",required:true,property:"campus"}},[s("bk-select",{model:{value:t.formData.campus,callback:function(e){t.$set(t.formData,"campus",e)},expression:"formData.campus"}},t._l(t.campusList,function(t){return s("bk-option",{key:t.id,attrs:{id:t.id,name:t.name}})}),1)],1)],1)]),t._v(" "),s("bk-col",{attrs:{span:3}},[s("div",{staticClass:"college"},[s("bk-form-item",{attrs:{label:"学院",required:true,property:"college"}},[s("bk-select",{model:{value:t.formData.college,callback:function(e){t.$set(t.formData,"college",e)},expression:"formData.college"}},t._l(t.collegeList,function(t){return s("bk-option",{key:t.id,attrs:{id:t.id,name:t.name}})}),1)],1)],1)]),t._v(" "),s("bk-col",{attrs:{span:3}},[s("div",{staticClass:"specificLocation"},[s("bk-form-item",{attrs:{label:"具体地点",required:true,property:"specificLocation"}},[s("bk-input",{attrs:{placeholder:""},model:{value:t.formData.specificLocation,callback:function(e){t.$set(t.formData,"specificLocation",e)},expression:"formData.specificLocation"}})],1)],1)]),t._v(" "),s("bk-col",{attrs:{span:3}},[s("div",{staticClass:"apply-num"},[s("bk-form-item",{attrs:{label:"申请数量",property:"applyNum"}},[s("bk-input",{attrs:{type:"number",min:1,precision:t.precision},model:{value:t.formData.num,callback:function(e){t.$set(t.formData,"num",e)},expression:"formData.num"}})],1)],1)])],1),t._v(" "),s("bk-row",{staticClass:"info-table-row"},[s("bk-col",{attrs:{span:3}},[s("div",{staticClass:"get-date"},[s("bk-form-item",{attrs:{label:"期望领用日期",property:"getDate",required:true}},[s("bk-date-picker",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",timer:false,disabled:false},model:{value:t.formData.getDate,callback:function(e){t.$set(t.formData,"getDate",e)},expression:"formData.getDate"}})],1)],1)]),t._v(" "),s("bk-col",{attrs:{span:9}},[s("div",{staticClass:"apply-reason"},[s("bk-form-item",{attrs:{required:true,label:"申请原因",property:"applyReason"}},[s("bk-input",{attrs:{type:"textarea"},model:{value:t.formData.applyReason,callback:function(e){t.$set(t.formData,"applyReason",e)},expression:"formData.applyReason"}})],1)],1)])],1),t._v(" "),s("bk-row",{staticClass:"info-table-row"},[s("bk-col",{attrs:{span:12}},[s("div",{staticClass:"commit"},[s("bk-button",{attrs:{size:"medium",outline:true,theme:"primary",title:"提交申请"},on:{click:function(e){e.stopPropagation();e.preventDefault();return t.commitApply(e)}}},[t._v("提交申请")])],1)])],1)],1)],1)],1):t._e(),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.showMultiImport,expression:"showMultiImport"}],staticClass:"multi-import-page"},[s("div",{staticClass:"success-apply"},[s("bk-table",{attrs:{data:t.successApply,size:t.medium,pagination:t.pagination},on:{select:t.selectRow,"select-all":t.selectAll,"row-mouse-enter":t.handleRowMouseEnter,"row-mouse-leave":t.handleRowMouseLeave,"page-change":t.handlePageChange,"page-limit-change":t.handlePageLimitChange}},[s("bk-table-column",{attrs:{type:"selection",width:"60"}}),t._v(" "),s("bk-table-column",{attrs:{label:"使用人",prop:"applicant"}}),t._v(" "),s("bk-table-column",{attrs:{label:"物品编码",prop:"goodCode"}}),t._v(" "),s("bk-table-column",{attrs:{label:"物品名称",prop:"goodName"}}),t._v(" "),s("bk-table-column",{attrs:{label:"数量",prop:"num"}}),t._v(" "),s("bk-table-column",{attrs:{label:"期望领用日期",prop:"getDate"}})],1)],1),t._v(" "),s("div",{staticClass:"multi-commit"},[s("bk-container",{attrs:{col:12,gutter:4}},[s("bk-row",[s("bk-col",{attrs:{span:11}},[s("bk-button",{staticStyle:{margin:"4px 10% 0 0"},attrs:{size:"medium",outline:true,theme:"primary",title:"提交申请"},on:{click:function(e){e.stopPropagation();e.preventDefault();return t.commitMultiApply(e)}}},[t._v("提交申请")])],1),t._v(" "),s("bk-col",{attrs:{span:1}},[s("div",{staticClass:"select-file"},[s("bk-upload",{staticClass:"upload-button",attrs:{theme:"button","with-credentials":true,"custom-request":t.upload,size:50,files:t.excelFiles,accept:".xls, .xlsx",limit:1}})],1)])],1)],1)],1),t._v(" "),s("div",{staticClass:"input-more"},[s("bk-dialog",{attrs:{theme:"primary",width:700,"mask-close":false,"header-position":"center","confirm-fn":t.confirmMultiCommit,"ok-text":"确定提交",title:"请完善信息"},model:{value:t.inputVisible,callback:function(e){t.inputVisible=e},expression:"inputVisible"}},[s("bk-form",{ref:"inputForm",attrs:{"label-width":130}},[s("bk-container",{attrs:{col:12,margin:6}},[s("bk-row",{staticStyle:{margin:"25px"}},[s("bk-col",{attrs:{span:12}},[s("div",{staticClass:"leaders"},[s("bk-form-item",{attrs:{label:"导员"}},[s("bk-tag",[t._v(t._s(t.multiInput.leaders))])],1)],1)])],1),t._v(" "),s("bk-row",{staticStyle:{margin:"25px"}},[s("bk-col",{attrs:{span:12}},[s("div",{staticClass:"campus"},[s("bk-form-item",{attrs:{label:"校区",required:true,property:"multiCampus"}},[s("bk-select",{model:{value:t.multiInput.campus,callback:function(e){t.$set(t.multiInput,"campus",e)},expression:"multiInput.campus"}},t._l(t.campusList,function(t){return s("bk-option",{key:t.id,attrs:{id:t.id,name:t.name}})}),1)],1)],1)])],1),t._v(" "),s("bk-row",{staticStyle:{margin:"25px"}},[s("bk-col",{attrs:{span:12}},[s("div",{staticClass:"college"},[s("bk-form-item",{attrs:{label:"学院",required:true,property:"multiCollege"}},[s("bk-select",{model:{value:t.multiInput.college,callback:function(e){t.$set(t.multiInput,"college",e)},expression:"multiInput.college"}},t._l(t.collegeList,function(t){return s("bk-option",{key:t.id,attrs:{id:t.id,name:t.name}})}),1)],1)],1)])],1),t._v(" "),s("bk-row",{staticStyle:{margin:"25px"}},[s("bk-col",{attrs:{span:12}},[s("div",{staticClass:"specificLocation"},[s("bk-form-item",{attrs:{label:"具体地点",required:true,property:"multiSpecificLocation"}},[s("bk-input",{attrs:{placeholder:""},model:{value:t.multiInput.specificLocation,callback:function(e){t.$set(t.multiInput,"specificLocation",e)},expression:"multiInput.specificLocation"}})],1)],1)])],1),t._v(" "),s("bk-row",{staticStyle:{margin:"25px"}},[s("bk-col",{attrs:{span:12}},[s("div",{staticClass:"apply-reason"},[s("bk-form-item",{attrs:{required:true,label:"申请原因",property:"multiApplyReason"}},[s("bk-input",{attrs:{type:"textarea"},model:{value:t.multiInput.applyReason,callback:function(e){t.$set(t.multiInput,"applyReason",e)},expression:"multiInput.applyReason"}})],1)],1)])],1)],1)],1)],1)],1)])])};var i=[];s.d(e,"a",function(){return a});s.d(e,"b",function(){return i})}}]);